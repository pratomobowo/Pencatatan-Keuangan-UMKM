generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String
  password      String?
  role          String    @default("user")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]

  @@index([email])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Product {
  id             String           @id @default(uuid())
  sku            String           @unique
  name           String
  description    String?
  price          Decimal          @db.Decimal(10, 2)
  costPrice      Decimal          @db.Decimal(10, 2)
  stock          Int              @default(0)
  unit           String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  image          String?
  isActive       Boolean          @default(true)
  isPromo        Boolean          @default(false)
  promoDiscount  Int?
  promoEndDate   DateTime?
  promoPrice     Decimal?         @db.Decimal(10, 2)
  promoStartDate DateTime?
  slug           String?          @unique
  categoryId     String?
  categoryName   String?
  favorites      Favorite[]
  orderItems     OrderItem[]
  category       Category?        @relation(fields: [categoryId], references: [id])
  variants       ProductVariant[]

  @@index([sku])
  @@index([name])
  @@index([categoryName])
  @@index([categoryId])
  @@index([isActive])
  @@index([isPromo])
}

model Category {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  image     String?
  color     String?
  order     Int       @default(0)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@index([order])
  @@index([isActive])
}

model ProductVariant {
  id        String   @id @default(uuid())
  productId String
  unit      String
  unitQty   Decimal  @db.Decimal(10, 3)
  price     Decimal  @db.Decimal(10, 2)
  costPrice Decimal  @db.Decimal(10, 2)
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, unit])
  @@index([productId])
}

model Customer {
  id            String         @id @default(uuid())
  name          String
  phone         String?        @unique
  address       String?
  notes         String?
  totalSpent    Decimal        @default(0) @db.Decimal(10, 2)
  orderCount    Int            @default(0)
  lastOrderDate DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  email         String?
  password      String?
  addresses     Address[]
  favorites     Favorite[]
  notifications Notification[]
  orders        Order[]

  @@index([phone])
  @@index([email])
  @@index([name])
}

model Address {
  id         String   @id @default(uuid())
  customerId String
  label      String
  name       String
  phone      String
  address    String
  isDefault  Boolean  @default(false)
  type       String   @default("home")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
}

model Order {
  id              String      @id @default(uuid())
  orderNumber     String      @unique
  customerId      String?
  customerName    String
  customerAddress String?
  customerPhone   String?
  subtotal        Decimal     @db.Decimal(10, 2)
  grandTotal      Decimal     @db.Decimal(10, 2)
  status          OrderStatus @default(PENDING)
  notes           String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deliveryTime    String?
  discount        Decimal     @default(0) @db.Decimal(10, 2)
  paymentMethod   String      @default("CASH")
  recipientName   String?
  recipientPhone  String?
  serviceFee      Decimal     @default(0) @db.Decimal(10, 2)
  shippingAddress String?
  shippingFee     Decimal     @default(0) @db.Decimal(10, 2)
  source          OrderSource @default(MANUAL)
  customer        Customer?   @relation(fields: [customerId], references: [id])
  items           OrderItem[]

  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
  @@index([source])
}

model OrderItem {
  id           String   @id @default(uuid())
  orderId      String
  productId    String?
  productName  String
  qty          Int
  unit         String
  price        Decimal  @db.Decimal(10, 2)
  originalPrice Decimal? @db.Decimal(10, 2)
  costPrice    Decimal? @db.Decimal(10, 2)
  total        Decimal  @db.Decimal(10, 2)
  productImage String?
  variant      String?
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product      Product? @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model Transaction {
  id          String          @id @default(uuid())
  date        DateTime        @default(now())
  type        TransactionType
  amount      Decimal         @db.Decimal(10, 2)
  category    String
  description String
  orderId     String?
  createdAt   DateTime        @default(now())

  @@index([date])
  @@index([type])
  @@index([orderId])
}

model CostComponent {
  id        String   @id @default(uuid())
  name      String
  cost      Decimal  @db.Decimal(10, 2)
  unit      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}

model Favorite {
  id         String   @id @default(uuid())
  customerId String
  productId  String
  createdAt  DateTime @default(now())
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([customerId, productId])
  @@index([customerId])
  @@index([productId])
}

model Notification {
  id         String   @id @default(uuid())
  customerId String
  title      String
  message    String
  type       String   @default("info")
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([createdAt])
}

model ShopConfig {
  id                   String   @id @default("global")
  
  // Store Info (Tab 1)
  storeName            String   @default("Pasarantar")
  storeTagline         String   @default("Protein Segar ke Rumah")
  storeLogo            String?
  storeDescription     String?
  
  // Contact & Location (Tab 2)
  contactInfo          String   @default("{}")
  storeLatitude        Decimal? @db.Decimal(10, 8)
  storeLongitude       Decimal? @db.Decimal(11, 8)
  googleMapsUrl        String?
  
  // Shipping - Distance Based (Tab 3)
  pricePerKm           Int      @default(2000)
  baseShippingFee      Int      @default(5000)
  maxDeliveryDistance  Int      @default(0)
  freeShippingMinimum  Int      @default(0)
  minimumOrder         Int      @default(0)
  serviceFee           Int      @default(0)
  
  // Payment (Tab 4)
  paymentMethods       String   @default("[]")
  qrisImage            String?  // QRIS QR Code image URL
  
  // Operational Hours (Tab 5)
  operationalHours     String   @default("{}")
  holidayMode          Boolean  @default(false)
  holidayMessage       String?
  
  // FAQ (Tab 6)
  faq                  String   @default("[]")
  
  updatedAt            DateTime @updatedAt
}

model PromoBanner {
  id         String   @id @default(uuid())
  title      String
  subtitle   String?
  badge      String?
  image      String
  buttonText String   @default("Belanja Sekarang")
  link       String   @default("/products")
  order      Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([isActive])
  @@index([order])
}

enum OrderSource {
  MANUAL
  ONLINE
}

enum OrderStatus {
  PENDING
  PAID
  CANCELLED
  CONFIRMED
  PREPARING
  SHIPPING
  DELIVERED
}

enum TransactionType {
  INCOME
  EXPENSE
  CAPITAL
}
